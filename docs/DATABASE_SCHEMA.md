# دليل قاعدة البيانات - نظام الأوقاف

## نظرة عامة

تم تطوير قاعدة بيانات شاملة لنظام إدارة الأوقاف تشمل جميع الجوانب من الأراضي والعقارات، العقود، التفتيش، الصيانة، المعاملات المالية، والمزيد.

---

## الجداول الأساسية

### 1. المحافظات والمواقع

#### `governorates` - المحافظات
جدول يحتوي على جميع المحافظات الفلسطينية.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `name_ar` - الاسم بالعربية
- `name_en` - الاسم بالإنجليزية
- `code` - كود المحافظة (مثل: RAM, JER, GZA)
- `region` - المنطقة (west_bank أو gaza)
- `population` - عدد السكان
- `area_km2` - المساحة بالكيلومتر المربع

#### `cities` - المدن والقرى
جدول يحتوي على جميع المدن والبلدات والقرى.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `governorate_id` - مرجع للمحافظة
- `name_ar` - الاسم بالعربية
- `type` - النوع (مدينة، بلدة، قرية، مخيم، حارة، منطقة)
- `population` - عدد السكان
- `area_km2` - المساحة

#### `locations` - المواقع التفصيلية
جدول يحتوي على مواقع إضافية تفصيلية.

---

### 2. الأراضي الوقفية

#### `waqf_lands` - الأراضي الوقفية
الجدول الرئيسي للأراضي والعقارات الوقفية.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `name` - اسم الوقف
- `description` - الوصف
- `area` - المساحة
- `type` - النوع (مسجد، مقبرة، مدرسة، تجاري، سكني، زراعي، مختلط)
- `status` - الحالة (نشط، غير نشط، قيد التطوير، متنازع عليه)
- `governorate` - المحافظة
- `value` - القيمة التقديرية
- `monthly_income` - الدخل الشهري
- `monthly_expenses` - المصروفات الشهرية
- `manager_id` - معرف المدير المسؤول
- `establishment_date` - تاريخ التأسيس
- `historical_period` - الفترة التاريخية
- `management_type` - نوع الإدارة
- `maintenance_status` - حالة الصيانة
- `national_registry_id` - رقم السجل الوطني

---

### 3. إدارة الموظفين

#### `waqf_managers` - مدراء الأوقاف
جدول يحتوي على معلومات المدراء والموظفين.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `admin_user_id` - مرجع لحساب المستخدم في النظام
- `name_ar` - الاسم بالعربية
- `national_id` - رقم الهوية الوطنية
- `phone` - رقم الهاتف
- `email` - البريد الإلكتروني
- `governorate_code` - كود المحافظة
- `position` - المنصب
- `department` - القسم
- `hire_date` - تاريخ التعيين
- `status` - الحالة (نشط، غير نشط، موقوف، متقاعد)
- `experience_years` - سنوات الخبرة

#### `asset_types` - أنواع الأصول الوقفية
جدول تصنيف أنواع الأصول الوقفية.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `name_ar` - الاسم بالعربية
- `category` - الفئة (ديني، تجاري، سكني، زراعي، تعليمي، صحي، خيري، مختلط)
- `icon` - أيقونة
- `color` - اللون

---

### 4. التفتيش والصيانة

#### `inspections` - سجلات التفتيش
جدول يحتوي على سجلات التفتيش الدورية.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `waqf_land_id` - معرف الأرض الوقفية
- `inspector_id` - معرف المفتش
- `inspection_date` - تاريخ التفتيش
- `inspection_type` - نوع التفتيش (دوري، طارئ، متابعة، سنوي، خاص)
- `status` - الحالة (مجدول، قيد التنفيذ، مكتمل، ملغي)
- `findings` - الملاحظات
- `recommendations` - التوصيات
- `overall_rating` - التقييم العام (ممتاز، جيد، مقبول، ضعيف، حرج)
- `requires_maintenance` - يتطلب صيانة
- `priority` - الأولوية (منخفضة، متوسطة، عالية، عاجلة)

#### `maintenance_records` - سجلات الصيانة
جدول يحتوي على سجلات أعمال الصيانة.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `waqf_land_id` - معرف الأرض الوقفية
- `inspection_id` - معرف التفتيش المرتبط
- `maintenance_type` - نوع الصيانة (وقائية، تصحيحية، طارئة، تجديد، ترميم)
- `description` - الوصف
- `status` - الحالة (معلق، موافق عليه، قيد التنفيذ، مكتمل، ملغي)
- `priority` - الأولوية
- `estimated_cost` - التكلفة المقدرة
- `actual_cost` - التكلفة الفعلية
- `contractor_name` - اسم المقاول
- `supervisor_id` - معرف المشرف

---

### 5. العقود والإيجارات

#### `tenants` - المستأجرين
جدول يحتوي على معلومات المستأجرين.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `name_ar` - الاسم بالعربية
- `national_id` - رقم الهوية أو السجل التجاري
- `phone` - رقم الهاتف
- `email` - البريد الإلكتروني
- `tenant_type` - نوع المستأجر (فرد، شركة، مؤسسة، حكومي)
- `business_type` - نوع النشاط

#### `contracts` - العقود
جدول يحتوي على جميع العقود.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `contract_number` - رقم العقد
- `waqf_land_id` - معرف الأرض الوقفية
- `tenant_id` - معرف المستأجر
- `contract_type` - نوع العقد (إيجار، بيع، شراكة، خدمة، صيانة، إدارة)
- `start_date` - تاريخ البداية
- `end_date` - تاريخ الانتهاء
- `status` - الحالة (مسودة، نشط، منتهي، مفسوخ، مجدد، ملغي)
- `monthly_amount` - المبلغ الشهري
- `total_amount` - المبلغ الإجمالي
- `payment_frequency` - تكرار الدفع
- `security_deposit` - التأمين

#### `leases` - تفاصيل الإيجارات
جدول تفصيلي للعقود من نوع إيجار.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `contract_id` - معرف العقد
- `lease_number` - رقم عقد الإيجار
- `monthly_rent` - الإيجار الشهري
- `utilities_included` - المرافق مشمولة
- `maintenance_responsibility` - مسؤولية الصيانة

---

### 6. المستندات والوثائق

#### `document_categories` - تصنيفات المستندات
جدول تصنيف أنواع المستندات.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `name_ar` - الاسم بالعربية
- `parent_id` - معرف الفئة الأب (للتصنيفات الفرعية)

#### `waqf_documents` - وثائق الأوقاف
جدول يحتوي على جميع المستندات والوثائق.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `document_number` - رقم المستند
- `title_ar` - العنوان بالعربية
- `category_id` - معرف التصنيف
- `document_type` - نوع المستند (سند، عقد، شهادة، تقرير، خريطة، صورة، قانوني، مالي، تقني، إداري)
- `related_entity_type` - نوع الكيان المرتبط
- `related_entity_id` - معرف الكيان المرتبط
- `file_path` - مسار الملف
- `file_url` - رابط الملف
- `issue_date` - تاريخ الإصدار
- `expiry_date` - تاريخ الانتهاء
- `access_level` - مستوى الوصول (عام، داخلي، سري، محظور)

---

### 7. المعاملات المالية

#### `financial_transactions` - المعاملات المالية
جدول يحتوي على جميع المعاملات المالية.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `transaction_number` - رقم المعاملة
- `waqf_land_id` - معرف الأرض الوقفية
- `contract_id` - معرف العقد
- `transaction_type` - نوع المعاملة (دخل، مصروف، تحويل، استرداد، إيداع)
- `category` - الفئة (إيجار، بيع، تبرع، صيانة، مرافق، رواتب، ضرائب، رسوم)
- `amount` - المبلغ
- `payment_method` - طريقة الدفع
- `transaction_date` - تاريخ المعاملة
- `status` - الحالة (معلق، مكتمل، ملغي، مسترد)
- `fiscal_year` - السنة المالية

#### `income_records` - سجلات الإيرادات
جدول تفصيلي للإيرادات.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `transaction_id` - معرف المعاملة
- `income_source` - مصدر الدخل
- `fiscal_year` - السنة المالية
- `quarter` - الربع
- `month` - الشهر
- `is_recurring` - دخل متكرر

#### `expense_records` - سجلات المصروفات
جدول تفصيلي للمصروفات.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `transaction_id` - معرف المعاملة
- `expense_category` - فئة المصروف
- `vendor_name` - اسم المورد
- `approval_status` - حالة الموافقة

---

### 8. الإشعارات والتنبيهات

#### `user_notifications` - إشعارات المستخدمين
جدول يحتوي على الإشعارات.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `user_id` - معرف المستخدم
- `title_ar` - العنوان بالعربية
- `message_ar` - الرسالة بالعربية
- `notification_type` - نوع الإشعار (معلومات، تحذير، خطأ، نجاح، تذكير، تنبيه)
- `priority` - الأولوية
- `is_read` - تم القراءة

#### `notification_settings` - إعدادات الإشعارات
جدول إعدادات الإشعارات لكل مستخدم.

#### `system_alerts` - التنبيهات النظامية
جدول التنبيهات التلقائية.

**أنواع التنبيهات:**
- تفتيش مستحق
- انتهاء عقد
- دفعة مستحقة
- صيانة مطلوبة
- انتهاء مستند

---

### 9. المهام والتعليقات

#### `user_tasks` - المهام
جدول إدارة المهام.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `title_ar` - عنوان المهمة
- `task_type` - نوع المهمة
- `priority` - الأولوية
- `status` - الحالة (معلق، قيد التنفيذ، مكتمل، ملغي، معلق مؤقتاً)
- `assigned_to` - معين إلى
- `due_date` - تاريخ الاستحقاق
- `completion_percentage` - نسبة الإنجاز

#### `entity_comments` - التعليقات
جدول التعليقات على الكيانات المختلفة.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `entity_type` - نوع الكيان
- `entity_id` - معرف الكيان
- `user_id` - معرف المستخدم
- `content` - المحتوى
- `parent_comment_id` - معرف التعليق الأب (للردود)

---

### 10. سجلات النشاطات

#### `audit_logs` - سجل المراجعة
جدول يسجل جميع العمليات المهمة.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `user_id` - معرف المستخدم
- `action` - الإجراء
- `entity_type` - نوع الكيان
- `entity_id` - معرف الكيان
- `old_values` - القيم القديمة
- `new_values` - القيم الجديدة
- `ip_address` - عنوان IP
- `created_at` - وقت التنفيذ

#### `system_logs` - سجلات النظام
جدول سجلات النظام التقنية.

**الأعمدة الرئيسية:**
- `id` - معرف فريد
- `log_level` - مستوى السجل (debug, info, warning, error, critical)
- `category` - الفئة
- `message` - الرسالة
- `details` - التفاصيل

---

## سياسات الأمان (RLS)

جميع الجداول محمية بسياسات Row Level Security:

### للمستخدمين المصادق عليهم:
- القراءة: مسموحة لجميع البيانات العامة
- الكتابة: مسموحة للمستخدمين المخولين فقط

### للمستندات السرية:
- الوصول: محدود للمستخدم المنشئ أو المخولين فقط

### للإشعارات والمهام:
- المستخدم يرى فقط إشعاراته ومهامه الخاصة

---

## الفهارس المحسّنة

تم إضافة فهارس على:
- الأعمدة المستخدمة في عمليات البحث
- المفاتيح الأجنبية
- التواريخ والحالات
- الأعمدة المستخدمة في التقارير

---

## البيانات التجريبية

تم إضافة بيانات تجريبية تشمل:
- 8 أنواع أصول وقفية
- 5 مدراء وقف
- 5 مستأجرين
- 6 تصنيفات مستندات

---

## ملاحظات مهمة

1. **الأمان**: جميع الجداول محمية بـ RLS
2. **الأداء**: تم إضافة فهارس شاملة
3. **التوثيق**: كل migration يحتوي على توثيق مفصل
4. **المرونة**: البنية تدعم التوسع المستقبلي
5. **التكامل**: الجداول مترابطة بعلاقات واضحة

---

## التطوير المستقبلي

يمكن إضافة:
- نظام الموافقات (Approval Workflows)
- نظام التقارير المتقدمة
- تكامل مع أنظمة خارجية
- نظام الأرشفة الإلكترونية
- خرائط GIS متقدمة
